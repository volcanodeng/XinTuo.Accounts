
@using XinTuo.Accounts.Models;
@{ 
    List<AccountCategoryRecord> cates = Model.Category;
    List<AuxiliaryTypeRecord> auxTypes = Model.AuxiliaryType;
}

<div class="easyui-layout" data-options="fit:true" >
    <div data-options="region:'north',split:false,border:false" style="height:80px;padding:10px;">
        @foreach (AccountCategoryRecord c in cates)
        {
            <a href="javascript:void(0)" id="cate_@c.Id" class="easyui-linkbutton" 
               data-options="iconCls:'icon-large-picture',size:'large',iconAlign:'top',toggle:true,group:'g1'" 
               onclick="varObject.mainCate=@c.Id" style="width:80px;">@c.CateName</a>
        }
    </div>
    <div data-options="region:'center',border:false" style="padding:10px;">
        <table class="easyui-datagrid" id="accDatagrid"
               data-options="singleSelect:true,toolbar: '#accToolbar',fit:true,idField:'AccCode'">
            <thead>
                <tr>
                    <th data-options="field:'AccCode'">@T("编码")</th>
                    <th data-options="field:'AccName'">@T("名称")</th>
                    <th data-options="field:'CateName'">@T("类别")</th>
                    <th data-options="field:'Direction'">@T("余额方向")</th>
                    <th data-options="field:'AuxNames'">@T("辅助核算")</th>
                    <th data-options="field:'Unit'">@T("数量单位")</th>
                    <th data-options="field:'AccState'">@T("状态")</th>
                </tr>
            </thead>
        </table>

        <div id="accToolbar">
            <a href="javascript:void(0)" class="easyui-linkbutton" data-options="plain:true" onclick="append()">新增</a>
            <a href="javascript:void(0)" class="easyui-linkbutton" data-options="plain:true" onclick="appendSub()">新增下级</a>
            <a href="javascript:void(0)" class="easyui-linkbutton" data-options="plain:true" onclick="edit()">编辑</a>
            <a href="javascript:void(0)" class="easyui-linkbutton" data-options="plain:true" onclick="remove()">删除</a>
        </div>
    </div>
</div>

<div id="editDialog" class="easyui-dialog" title="编辑科目" style="width:450px;height:600px;font-size:14pt;" data-options="resizable:false,modal:true,closed: true,onBeforeOpen:editOnBeforeOpen">
    <form id="accForm" method="post">

        <div>
            <input class="easyui-textbox" id="AccCode" name="AccCode" data-options="label:'@T("科目编码")',required:true" style="width:90%;height:32px">
        </div>

        <div>
            <input class="easyui-textbox" id="AccName" name="AccName" data-options="label:'@T("科目名称")',required:true" style="width:90%;height:32px">
        </div>

        <div>
            <input class="easyui-textbox" id="ParentCode" name="ParentCode" data-options="label:'@T("上级科目")',required:true" style="width:90%;height:32px">
        </div>

        <div>
            <input class="easyui-combobox" id="CateId" name="CateId" data-options="label:'@T("科目类别")',required:true,valueField:'id',textField:'cateName',method: 'GET'" style="width:90%;height:32px">
        </div>

        <div>
            <label for="dirGroup" style="display:inline-block;" class="textbox-label textbox-label-before">余额方向</label>
            <fieldset id="dirGroup" style="display:inline;">
                <input type="radio" id="dirDebit" name="dir" value="debit" /><label for="dirDebit" style="display:inline;font-weight:bold;margin-right:10px;">借</label> 
                <input type="radio" id="dirCredit" name="dir" value="credit" /><label for="dirCredit" style="display:inline;font-weight:bold;">贷</label>
            </fieldset>
        </div>

        <div>
            <input type="checkbox" id="aux" name="aux" /><label for="aux" style="display:inline;margin-left:5px;">辅助核算</label>
            <div id="auxItems" style="display:inline-block;">
                @foreach (AuxiliaryTypeRecord aux in auxTypes)
                {
                    <input type="checkbox" id="aux_@aux.Id" name="aux_@aux.Id" /><label for="aux_@aux.Id" style="display:inline;margin-left:5px;">@aux.AuxType</label>
                }
            </div>
        </div>

        <div>
            <input type="checkbox" id="quantity" name="quantity" /><label for="quantity" style="display:inline;margin-left:5px;">数量核算</label>
            <div id="qtyUnit" style="display:inline-block;">
                <input class="easyui-textbox" id="Unit" name="Unit" data-options="label:'@T("计量单位")'" style="width:80px;height:32px">
            </div>
        </div>

        <div style="text-align:right;">
            <a href="javascript:void(0)" class="easyui-linkbutton" onclick="save()" style="width:80px">确 定</a>
            <a href="javascript:void(0)" class="easyui-linkbutton" onclick="cancel()" style="width:80px">取 消</a>
            <input type="hidden" id="acctCate" name="acctCate" />
            <input type="hidden" id="__RequestVerificationToken" name="__RequestVerificationToken" value="@Html.AntiForgeryTokenValueOrchard()" />
        </div>

    </form>
</div>

<style type="text/css">
    #accForm div{
        padding:10px;
    }

    #accForm input {
        font-size:14pt;
    }
</style>

<script type="text/javascript">

    var varObject = {
        mainCate:-1
    };

    $(function () {
        init();
    });

    function init()
    {
        $("#accForm").form({
            url: "/api/a/Save/",
            onSubmit: formOnSubmit,
            success: formSuccess
        });

        $("#aux").change(function () {
            if($(this).is(":checked"))
            {
                $("#auxItems").show();
            }
            else
            {
                $("#auxItems").hide();
            }
        });
        $("#auxItems").hide();

        $("#quantity").change(function () {
            if ($(this).is(":checked")) {
                $("#qtyUnit").show();
            }
            else {
                $("#qtyUnit").hide();
            }
        });
        $("#qtyUnit").hide();

        $("#cate_1").click();
    }

    function append()
    {
        $("#editDialog").dialog('open');
    }

    function editOnBeforeOpen()
    {
        $("#CateId").combobox('reload', '/api/a/GetSubAccCate?cid=' + varObject.mainCate);
    }

    function save()
    {
        $("#accForm").submit();
    }

    function formOnSubmit() {
        return $(this).form('validate');
    }

    function formSuccess(data) {
        formSuccessHandle(data);
    }

    function cancel()
    {
        $('#accForm').form('clear');
        $("#editDialog").dialog('close');
    }
</script>