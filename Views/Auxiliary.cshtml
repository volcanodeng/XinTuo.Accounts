@using XinTuo.Accounts.Models;
@{
    AuxiliaryTypeRecord auxType = Model.AuxType;
    List<AuxiliaryTypeRecord> BaseAuxTypes = Model.BaseAuxTypes;
}

<div class="easyui-layout" data-options="fit:true">
    <div data-options="region:'north',split:false,border:false" style="height:80px;padding:10px;">
        @foreach (AuxiliaryTypeRecord aux in BaseAuxTypes)
        {
            <a href="javascript:void(0)" id="auxType_@aux.Id" class="easyui-linkbutton"
               @if (aux.Id == auxType.Id)
               { <text> data-options="toggle:true,group:'g1',selected:true" </text>}
               else { <text> data-options="toggle:true,group:'g1'" </text>}
               onclick="auxTypeClick(@aux.Id)" style="width:80px;">@aux.AuxType</a>
        }

    </div>

    <div data-options="region:'center',border:false" style="padding:10px;">
        <table class="easyui-datagrid" id="auxDatagrid"
               data-options="singleSelect:true,toolbar: '#auxToolbar',fit:true,idField:'AccCode'">
            <thead>
                <tr>
                    <th data-options="field:'AuxCode'">@T("编码")</th>
                    <th data-options="field:'AuxName'">@T("名称")</th>
                    <th data-options="field:'AuxState'">@T("状态")</th>
                </tr>
            </thead>
        </table>

        <div id="auxToolbar">
            <a href="javascript:void(0)" class="easyui-linkbutton" data-options="plain:true" onclick="append()">新增</a>
            <a href="javascript:void(0)" class="easyui-linkbutton" data-options="plain:true" onclick="edit()">编辑</a>
            <a href="javascript:void(0)" class="easyui-linkbutton" data-options="plain:true" onclick="remove()">删除</a>
        </div>
    </div>

</div>

<div id="editDialog" class="easyui-dialog" title="编辑科目" style="width:450px;height:200px;font-size:14pt;" data-options="resizable:false,modal:true,closed: true">
    <form id="auxForm" method="post">
        <div>
            <input class="easyui-textbox" id="atCode" name="atCode" data-options="label:'@T("编码")'" style="width:90%;height:32px">
        </div>
        <div>
            <input class="easyui-textbox" id="atName" name="atName" data-options="label:'@T("名称")'" style="width:90%;height:32px">
            <input type="hidden" id="AuxTypeId" name="AuxTypeId" />
        </div>
        <div style="float:right;">
            <a href="javascript:void(0)" class="easyui-linkbutton" onclick="save()" style="width:80px">保存</a>
            <a href="javascript:void(0)" class="easyui-linkbutton" onclick="diaClose()" style="width:80px">关闭</a>
        </div>
    </form>
</div>

<style type="text/css">
    #auxForm div {
        padding: 10px;
    }

    #auxForm input {
        font-size: 14pt;
    }
</style>

<script type="text/javascript">

    var varObject = {
        auxTypeId: -1
    };

    $(function () {
        init();
    });

    function init()
    {
        $("#AuxTypeId").val(@auxType.Id);

        $("#auxForm").form({
            url: "/api/aux/Save/",
            onSubmit: formOnSubmit,
            success: formSuccess
        });
    }

    function auxTypeClick(auxType)
    {
        $("#AuxTypeId").val(auxType);
    }

    function append()
    {
        $("#editDialog").dialog("open");
    }

    function edit()
    {
        $("#editDialog").dialog("open");
    }

    function save()
    {

        $("#auxForm").submit();
    }

    function diaClose()
    {
        $("#editDialog").dialog("close");
    }

    function formOnSubmit() {
        return $(this).form('validate');
    }

    function formSuccess(data) {
        if(data == null)return;
        var data = JSON.parse(data);

        if(data.message != null){
            $.messager.alert("保存",data.message,"warning");
            return;
        }
        else
        {
            $.messager.show({title:"保存",msg:"保存成功"});
        }
    }

</script>
